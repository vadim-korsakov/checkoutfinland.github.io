<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Checkout API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;code&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="code">code</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>The following document describes the Checkout Finlands general public API in the context of payment buttons and making payments through the API.</p>

<p>Also included are APIs used for polling the status of a payment and to fetch contents of settlement reports.</p>

<p>To get started with the API, get in touch with Checkout Finland&rsquo;s customer support and you will be directed into the right direction from there. API is available for use for our merchants and partners.</p>

<h1 id="testing">Testing</h1>

<blockquote>
<p>Example class implementation that will be used in the later examples</p>
</blockquote>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Checkout</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$version</span> <span class="o">=</span> <span class="s2">"0001"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$language</span> <span class="o">=</span> <span class="s2">"FI"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$country</span> <span class="o">=</span> <span class="s2">"FIN"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$currency</span> <span class="o">=</span> <span class="s2">"EUR"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$device</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$content</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$type</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$algorithm</span> <span class="o">=</span> <span class="s2">"3"</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$merchant</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$password</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$stamp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$reference</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$return</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$cancel</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$reject</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$delayed</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$delivery_date</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$firstname</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$familyname</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$address</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$postcode</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$postoffice</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$status</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$email</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$merchant</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">merchant</span> <span class="o">=</span> <span class="nv">$merchant</span><span class="p">;</span> <span class="c1">// merchant id
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="nv">$password</span><span class="p">;</span> <span class="c1">// security key (about 80 chars)
</span>    <span class="p">}</span>

    <span class="cm">/*
     * generates MAC and prepares values for creating payment
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCheckoutObject</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// overwrite default values
</span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$mac</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">version</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stamp</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">amount</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reference</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">language</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">merchant</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">return</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cancel</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reject</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delayed</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currency</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">device</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">algorithm</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delivery_date</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">firstname</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">familyname</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">address</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postcode</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postoffice</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="si">}</span><span class="s2">"</span><span class="p">));</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">version</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'STAMP'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stamp</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'AMOUNT'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">amount</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'REFERENCE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reference</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'MESSAGE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'LANGUAGE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">language</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'MERCHANT'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">merchant</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'RETURN'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">return</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'CANCEL'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cancel</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'REJECT'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reject</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'DELAYED'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delayed</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'COUNTRY'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'CURRENCY'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currency</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'DEVICE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">device</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'CONTENT'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'TYPE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'ALGORITHM'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">algorithm</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'DELIVERY_DATE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delivery_date</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'FIRSTNAME'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">firstname</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'FAMILYNAME'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">familyname</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'ADDRESS'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">address</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'POSTCODE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postcode</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'POSTOFFICE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postoffice</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'MAC'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$mac</span><span class="p">;</span>

        <span class="nv">$post</span><span class="p">[</span><span class="s1">'EMAIL'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
        <span class="nv">$post</span><span class="p">[</span><span class="s1">'PHONE'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phone</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$post</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/*
     * returns payment information in XML
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCheckoutXML</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">device</span> <span class="o">=</span> <span class="s2">"10"</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sendPost</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCheckoutObject</span><span class="p">(</span><span class="nv">$data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">sendPost</span><span class="p">(</span><span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="nx">CURLOPT_POST</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">CURLOPT_HEADER</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">CURLOPT_URL</span> <span class="o">=&gt;</span> <span class="s1">'https://payment.checkout.fi'</span><span class="p">,</span>
                <span class="nx">CURLOPT_FRESH_CONNECT</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">CURLOPT_RETURNTRANSFER</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">CURLOPT_FORBID_REUSE</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">CURLOPT_TIMEOUT</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">,</span>
                <span class="nx">CURLOPT_POSTFIELDS</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$post</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
        <span class="nb">curl_setopt_array</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
        <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateCheckout</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$generatedMac</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'STAMP'</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'REFERENCE'</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'PAYMENT'</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'STATUS'</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'ALGORITHM'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">));</span>
        <span class="k">return</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'MAC'</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$generatedMac</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isPaid</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// class Checkout
</span></code></pre>
<p>Test credentials</p>

<ul>
<li>Merchant Id (MERCHANT): <code class="prettyprint">375917</code></li>
<li>Secret Key: <code class="prettyprint">SAIPPUAKAUPPIAS</code></li>
</ul>

<p>Please note that not all payment methods support testing. The payment methods are enabled that support testing payments. There might be some features that are not working as they are intended to work in the testing side due to limitations to external integrations.</p>

<p>The whole test code is available at: <a href="http://demo1.checkout.fi/xml2.txt">http://demo1.checkout.fi/xml2.txt</a>.</p>

<h1 id="general-flow">General flow</h1>

<h2 id="examples">Examples</h2>

<h3 id="payment-process">Payment process</h3>

<p>The following illustrates how the user moves in the payment process.</p>

<p><img src="images/flow.png" alt="flow-diagram" /></p>

<ol>
<li>Buyer goes into Checkout.fi</li>
<li>Chooses payment method</li>
<li>Paid for the purchase</li>
<li>Returns automatically to the merchant with the information of successful payment</li>
<li>If for some reason the buyer did not return to the merchant, Checkout queries the payment method provider for the information of the payment</li>
<li>Receive information from the payment method provider that the payment went through correctly</li>
<li>Inform merchant of the successful payment.</li>
<li>Merchant queries the payment status from Checkout</li>
<li>Checkout replies with the status</li>
</ol>

<h1 id="tokenization-api">Tokenization API</h1>

<h2 id="add-and-tokenize-a-new-card">Add and tokenize a new card</h2>

<p>API for adding and tokenizing credit cards. Cards are automatically tokenized and migrated - the provider-token is 
migrated with checkout&rsquo;s tokens and the checkout token is responded. API uses redirections to handle information and 
moving between services. Requests are secured using hmac calculation using shared secret between message sender and
receiver.</p>

<p>The card adding flow has two phases :</p>

<p>1 - Request for the form</p>

<ul>
<li>On succeeded request the form is shown otherwise redirected to failure URL (or error shown see more below)</li>
</ul>

<p>2 - Submit OR Cancel the form</p>

<ul>
<li>On succeeded request token is created and redirected to success URL with parameters (containg the token)</li>
<li>On failure/error cases redirected to failure URL</li>
<li>On cancelling the form redirected to cancel URL</li>
</ul>

<h3 id="simplified-flow-of-adding-a-card">Simplified flow of adding a card</h3>

<p>See detailed flow <a href="images/add_card_flow_full.svg">here</a>.</p>

<p><img src="images/add_card_flow_simplified.svg" alt="Simplified add card flow" /></p>

<h3 id="api-endpoint">API endpoint</h3>

<ul>
<li><code class="prettyprint">POST</code>: https://payment.checkout.fi/token/card/add</li>
</ul>

<h3 id="test-merchant-and-secret">Test merchant and secret :</h3>

<ul>
<li>merchant id : 375917</li>
<li>merchant secret : SAIPPUAKAUPPIAS</li>
</ul>

<h3 id="request-parameters">Request parameters</h3>

<blockquote>
<p>Sample request to initiate card add form</p>
</blockquote>
<pre class="highlight plaintext"><code>POST /token/card/add HTTP/1.1
Host: payment.checkout.fi
Connection: keep-alive
Content-Length: 317
Pragma: no-cache
Cache-Control: no-cache
Content-Type: application/x-www-form-urlencoded
DNT: 1

merchant=375917&amp;failure_url=https%3A%2F%2Fdemo.checkout.fi%2Faddcard%2Ffail&amp;cancel_url=https%3A%2F%2Fdemo.checkout.fi%2Faddcard%2Fcancel&amp;success_url=https%3A%2F%2Fdemo.checkout.fi%2Faddcard%2Fsuccess&amp;request_id=a1ea51cd-24d0-4ac5-a035-0644d971ca57&amp;hmac=5c998d76d1ddb9f5ed3375d5ba49ec90b46f52a6177c4a8b1bbb93348a9ad1b1
</code></pre>
<p>Initial POST request is made to API endpoint with following parameters (all parameters are mandatory) :</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>merchant</td>
<td>AN</td>
<td>merchant id</td>
</tr>
<tr>
<td>success_url</td>
<td>AN</td>
<td>Redirection URL on succeeded action</td>
</tr>
<tr>
<td>failure_url</td>
<td>AN</td>
<td>Redirection URL on failure</td>
</tr>
<tr>
<td>cancel_url</td>
<td>AN</td>
<td>Redirection URL on user cancel</td>
</tr>
<tr>
<td>request_id</td>
<td>UUID4</td>
<td>Unique identificator for the request</td>
</tr>
<tr>
<td>hmac</td>
<td>AN</td>
<td> Hash calculated from message parameters</td>
</tr>
</tbody></table>

<h3 id="sample-parameters">Sample parameters :</h3>

<p>Parameters on the example query:</p>

<ul>
<li>merchant : 375917</li>
<li>failure_url : https://demo.checkout.fi/addcard/fail</li>
<li>cancel_url : https://demo.checkout.fi/addcard/cancel</li>
<li>success_url : https://demo.checkout.fi/addcard/success</li>
<li>request_id : a1ea51cd-24d0-4ac5-a035-0644d971ca57</li>
<li>hmac : 5c998d76d1ddb9f5ed3375d5ba49ec90b46f52a6177c4a8b1bbb93348a9ad1b1</li>
</ul>

<h3 id="hmac-calculation">HMAC calculation</h3>

<blockquote>
<p>Parameter string ready for SHA256 hmac calculation </p>
</blockquote>
<pre class="highlight plaintext"><code>var macString = 'cancel_url:https://demo.checkout.fi/addcard/cancel
failure_url:https://demo.checkout.fi/addcard/fail
merchant:375917
request_id:25d52044-31d5-48f3-b605-307671d668cd
success_url:https://demo.checkout.fi/addcard/success';

var hmac = HmacSHA256(macString, 'SAIPPUAKAUPPIAS');

// Correct SHA256 HMAC for string above is :
// 5c998d76d1ddb9f5ed3375d5ba49ec90b46f52a6177c4a8b1bbb93348a9ad1b1
</code></pre>
<p>Colon separated and alpabetically ordered name/value pairs are concatenated with &lsquo;new line&rsquo; char (\n) and 
SHA265 HMAC is calculated with merchants secret. </p>

<h3 id="responses">Responses</h3>

<p>On successfull add card request the HTML-document containing the form is returned.</p>

<p>On errors and failures the page is redirected to given failure URL with parameters. Parameters give more detailed
information on the failure.</p>

<p>Note: on some rare cases HTML output is shown instead. E.g. missing one of the required parameters (failure url for example)</p>

<h3 id="response-parameters">Response parameters</h3>

<table><thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>co_code</td>
<td>INT</td>
<td>reaponse status (see detailed codes on below)</td>
</tr>
<tr>
<td>co_request_id</td>
<td>UUID4</td>
<td>unified request identifier</td>
</tr>
<tr>
<td>co_status</td>
<td>AN</td>
<td>response status text (see detailed codes on below)</td>
</tr>
<tr>
<td>co_token</td>
<td>UUID4</td>
<td> Checkout token</td>
</tr>
<tr>
<td>hmac</td>
<td>AN</td>
<td>Hash calculated from co_ parameters</td>
</tr>
</tbody></table>

<h3 id="status-codes-on-redirect-url-39-s">Status codes on redirect URL&rsquo;s</h3>

<table><thead>
<tr>
<th>co_code</th>
<th>co_status</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>0</td>
<td>ok</td>
<td>Token got, created and migrated ok</td>
</tr>
<tr>
<td>100</td>
<td>fail</td>
<td>Missing mandatory parameters</td>
</tr>
<tr>
<td>102</td>
<td>fail</td>
<td>HMAC validation failed (check merchant id)</td>
</tr>
<tr>
<td>103</td>
<td>fail</td>
<td>HMAC validation failed</td>
</tr>
<tr>
<td>104</td>
<td>fail</td>
<td>Failed creating form + detailed information</td>
</tr>
<tr>
<td>105</td>
<td>fail</td>
<td>Failed creating a form</td>
</tr>
<tr>
<td>150</td>
<td>fail</td>
<td>Missing mandatory parameters</td>
</tr>
<tr>
<td>151</td>
<td>fail</td>
<td>Invalid request-id</td>
</tr>
<tr>
<td>152</td>
<td>fail</td>
<td>Invalid request-id</td>
</tr>
<tr>
<td>153</td>
<td>fail</td>
<td>Provider token already exists, tried to create duplicate</td>
</tr>
<tr>
<td>154</td>
<td>fail</td>
<td>Callback failed + detailed information</td>
</tr>
</tbody></table>

<h2 id="token-migration">Token migration</h2>

<p>Will convert an external token (for example Solinor token) to a Checkout-token, which can then be used for making payments in Checkout Finland Payment API.</p>

<p>If token has already been migrated earlier, statusCode &#39;201&rsquo; and Checkout-token will be returned.</p>
<pre class="highlight plaintext"><code>POST /token/migrate HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

merchant=375917&amp;provider_token=1296b3bc-407b-439b-9afd-c138e3ababa3
</code></pre>
<h3 id="http-request">HTTP Request</h3>

<ul>
<li><code class="prettyprint">POST</code>: https://payment.checkout.fi/token/migrate</li>
</ul>

<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>provider_token</td>
<td>UUID4</td>
<td>External (e.g. Solinor) token</td>
<td>1</td>
</tr>
<tr>
<td>merchant</td>
<td>N</td>
<td>Merchant ID given by Checkout</td>
<td></td>
</tr>
</tbody></table>

<p><em>Note 1.)</em> Must match ^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-(8|9|a|b)[a-f0-9]{3}-[a-f0-9]{12}$</p>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
    <span class="nt">&lt;statusCode&gt;</span>200<span class="nt">&lt;/statusCode&gt;</span>
    <span class="nt">&lt;statusText&gt;</span>Token was migrated successfully<span class="nt">&lt;/statusText&gt;</span>
    <span class="nt">&lt;token&gt;</span>4c9705fd-c31d-4d2f-accf-f07b63eb80fe<span class="nt">&lt;/token&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<h3 id="http-response-http-200">HTTP Response (HTTP 200)</h3>

<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>token</td>
<td>UUID4</td>
<td>Checkout-token</td>
</tr>
<tr>
<td>statusCode</td>
<td>SCODE</td>
<td>Checkout status code, described in table below</td>
</tr>
<tr>
<td>statusText</td>
<td>AN</td>
<td>status message, e.g. &#39;Token has already been migrated&hellip;&rsquo;</td>
</tr>
</tbody></table>

<h4 id="status-codes-amp-texts">Status codes &amp; -texts</h4>

<table><thead>
<tr>
<th>Status Code</th>
<th>Status Text</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Token was migrated successfully</td>
</tr>
<tr>
<td>201</td>
<td>Token has already been migrated, will return existing checkout-token</td>
</tr>
<tr>
<td>400</td>
<td>Merchant with given ID not found.</td>
</tr>
<tr>
<td>500</td>
<td>General internal server error</td>
</tr>
</tbody></table>

<h1 id="payment-api">Payment API</h1>

<h2 id="payment">Payment</h2>

<h3 id="url">URL</h3>

<ul>
<li><code class="prettyprint">POST</code>: https://payment.checkout.fi</li>
</ul>

<h3 id="field-descriptions">Field descriptions</h3>

<blockquote>
<p>Example uses the earlier created class (in testing stage)</p>
</blockquote>
<pre class="highlight php"><code>// Order information
$coData = array();
$coData["stamp"] = time(); // unique timestamp
$coData["reference"] = "12344";
$coData["message"] = "Furniture materials\nSome wood, dust and magic fairies";
$coData["return"] = "http://demo1.checkout.fi/xml2.php?test=1";
$coData["delayed"] = "http://demo1.checkout.fi/xml2.php?test=2";
$coData["amount"] = "1000"; // price in cents
$coData["delivery_date"] = date("Ymd");
$coData["firstname"] = "Matti";
$coData["familyname"] = "Meikäläinen";
$coData["address"] = "Ääkköstie 5b3\nKulmaravintolan yläkerta";
$coData["postcode"] = "33100";
$coData["postoffice"] = "Tampere";
$coData["email"] = "support@checkout.fi";
$coData["phone"] = "0800 552 010";

// coObject for old method
$coObject = $co-&gt;getCheckoutObject($coData);
// change stamp for xml method so that the new call has unique stamp compared to the previous
$coData['stamp'] = time() + 1;
$response = $co-&gt;getCheckoutXML($coData); // get payment button data
$xml = simplexml_load_string($response);
</code></pre>
<table><thead>
<tr>
<th>#</th>
<th>Description</th>
<th>Name</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>Payment version. Always &ldquo;0001&rdquo;.</td>
<td>VERSION</td>
<td>&ldquo;0001&rdquo;</td>
<td>AN 4</td>
<td>Yes </td>
</tr>
<tr>
<td>2</td>
<td>Unique identifier for the payment in the context of the merchant. Has to be unique.</td>
<td>STAMP</td>
<td>unique_id</td>
<td>AN 20</td>
<td>Yes </td>
</tr>
<tr>
<td>3</td>
<td>Payment amount in cents.</td>
<td>AMOUNT</td>
<td>0</td>
<td>N 8</td>
<td>Yes </td>
</tr>
<tr>
<td>4</td>
<td>Payment reference number for the payment from the merchant.</td>
<td>REFERENCE</td>
<td>standard_reference</td>
<td>AN 20</td>
<td>Yes </td>
</tr>
<tr>
<td>5</td>
<td>Payment message from the Merchant to the buyer</td>
<td>MESSAGE</td>
<td>&ldquo;Hi, thanks for shopping.&rdquo;</td>
<td>AN 1000</td>
<td>No</td>
</tr>
<tr>
<td>6</td>
<td>Payment language. Options currently are: &ldquo;FI&rdquo;, &ldquo;EN&rdquo;, &ldquo;SE&rdquo;.</td>
<td>LANGUAGE</td>
<td>&ldquo;FI&rdquo;</td>
<td>AN 2</td>
<td>No</td>
</tr>
<tr>
<td>7</td>
<td>Merchant Id. Given identifier for the merchant (you get this from Checkout Finland), for testing: 375917</td>
<td>MERCHANT</td>
<td>375917</td>
<td>AN 20</td>
<td>Yes</td>
</tr>
<tr>
<td>8</td>
<td>Return callback. Called when the payment is successfully paid.</td>
<td>RETURN</td>
<td></td>
<td>AN 300</td>
<td>Yes</td>
</tr>
<tr>
<td>9</td>
<td>Cancel callback. Called when the payment is cancelled for some reason.</td>
<td>CANCEL</td>
<td></td>
<td>AN 300</td>
<td>Yes</td>
</tr>
<tr>
<td>10</td>
<td>Reject callback. Called when the payment is rejected. If not defined, on reject the cancel will be called.</td>
<td>REJECT</td>
<td></td>
<td>AN 300</td>
<td>No</td>
</tr>
<tr>
<td>11</td>
<td>Delayed callback. Called if the payment is delayed.</td>
<td>DELAYED</td>
<td></td>
<td>AN 300</td>
<td>No</td>
</tr>
<tr>
<td>12</td>
<td>Country, ISO-3166-1 alpha-3.</td>
<td>COUNTRY</td>
<td>&ldquo;FIN&rdquo;</td>
<td>AN 3</td>
<td>No</td>
</tr>
<tr>
<td>13</td>
<td>Valuutta. Currently always EUR.</td>
<td>CURRENCY</td>
<td>&ldquo;EUR&rdquo;</td>
<td>AN 3</td>
<td>Yes</td>
</tr>
<tr>
<td>14</td>
<td>Device type. <code class="prettyprint">1 = HTML</code>, <code class="prettyprint">10 = XML</code>.</td>
<td>DEVICE</td>
<td>1</td>
<td>N 2</td>
<td>Yes</td>
</tr>
<tr>
<td>15</td>
<td>Content of the purchase. <code class="prettyprint">1 = Normal</code>, <code class="prettyprint">2 = adult industry</code></td>
<td>CONTENT</td>
<td>1</td>
<td>N 2</td>
<td>Yes</td>
</tr>
<tr>
<td>16</td>
<td>Payment types.</td>
<td>TYPE</td>
<td>0</td>
<td>N 1</td>
<td>Yes</td>
</tr>
<tr>
<td>17</td>
<td>Checksum calculation algorithm. Use 3 commonly.</td>
<td>ALGORITHM</td>
<td>3</td>
<td>N 1</td>
<td>Yes</td>
</tr>
<tr>
<td>18</td>
<td>Delivery date. Format: YYYYMMDD.</td>
<td>DELIVERY_DATE</td>
<td>20171231</td>
<td>N 8</td>
<td>Yes</td>
</tr>
<tr>
<td>19</td>
<td>Required when using loaning services. First name of the buyer.</td>
<td>FIRSTNAME</td>
<td>&ldquo;Matti&rdquo;</td>
<td>AN 40</td>
<td>No</td>
</tr>
<tr>
<td>20</td>
<td>Required when using loaning services. Last name of the buyer.</td>
<td>FAMILYNAME</td>
<td>&ldquo;Meikäläinen&rdquo;</td>
<td>AN 40</td>
<td>No</td>
</tr>
<tr>
<td>21</td>
<td>Required when using loaning services. Delivery address.</td>
<td>ADDRESS</td>
<td>&ldquo;Maantie 123&rdquo;</td>
<td>AN 40</td>
<td>No</td>
</tr>
<tr>
<td>22</td>
<td>Required when using loaning services. Delivery post number.</td>
<td>POSTCODE</td>
<td>&ldquo;12345&rdquo;</td>
<td>AN 14</td>
<td>No</td>
</tr>
<tr>
<td>23</td>
<td>Required when using loaning services. Delivery postal office.</td>
<td>POSTOFFICE</td>
<td>&ldquo;&rdquo;</td>
<td>AN 18</td>
<td>No</td>
</tr>
<tr>
<td>24</td>
<td>Checksum is calculated by combining fields 1-23 and the secret key, separating them with a <code class="prettyprint">+</code>-sign</td>
<td>MAC</td>
<td></td>
<td>AN 32</td>
<td>Yes</td>
</tr>
<tr>
<td>25</td>
<td>Buyer email.</td>
<td>EMAIL</td>
<td></td>
<td>AN 200</td>
<td>No</td>
</tr>
<tr>
<td>26</td>
<td>Buyer phone number.</td>
<td>PHONE</td>
<td></td>
<td>AN 30</td>
<td>No</td>
</tr>
</tbody></table>

<p><em>Field 14</em>: If you want to use Checkouts payment wall, use HTML device type (end point). If the payment buttons are getting integrated as part of merchants online service, use XML. Checkout recommends using XML as it allows more tight integration and customization. HTTP POST is done by the integrating service and Checkout replies with XML payment wall that the service then can open and manipulate to render the payment wall.</p>

<p><em>Field 17</em>: <code class="prettyprint">3 == sha256 and md5</code>. Payment is created with MD5 and the return checksum is calculated with SHA256.</p>

<p><em>Field 18</em>: Best estimate of the delivery date of the product. If no date is known, use the latest possible date. Products that require loan are sent to the buyer by the delivery date.</p>

<h3 id="calculating-the-checksum">Calculating the checksum</h3>

<p>When calculating the checksum use the fields 1 to 23 and the security key as the last field. The fields are separated from each other with <code class="prettyprint">+</code> -sign. If a field is empty, use empty string in the calculation. The calculated checksum needs to be transferred in capitalized characters. Check is done with the method defined in field 17.</p>

<blockquote>
<p>Example of calculating the MD5</p>
</blockquote>
<pre class="highlight php"><code>MD5(
  VERSION+STAMP+AMOUNT+REFERENCE+MESSAGE+
  LANGUAGE+MERCHANT+RETURN+CANCEL+REJECT+
  DELAYED+COUNTRY+CURRENCY+DEVICE+CONTENT+
  TYPE+ALGORITHM+DELIVERY_DATE+FIRSTNAME+
  FAMILYNAME+ADDRESS+POSTCODE+POSTOFFICE+SECRET_KEY
)
</code></pre>
<h3 id="response">Response</h3>

<p>The response will arrive with the users browser, if the user returns to the service. If the for some reason this does not happen, Checkout will send a HTTP GET -request to the same address the browser was supposed to be redirected to, the service has to accept the incoming HTTP GET from Checkout even though it might lack cookies or a session. The message will be checked with MAC -check.</p>

<p>Additional information on how to do the check can be found from the example file:  <a href="http://demo1.checkout.fi/xml2.txt">http://demo1.checkout.fi/xml2.txt</a>.</p>

<table><thead>
<tr>
<th> #</th>
<th> Description</th>
<th> Field</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>Payment version. Always &ldquo;0001&rdquo;.</td>
<td>VERSION</td>
<td>&ldquo;0001&rdquo;</td>
</tr>
<tr>
<td>2</td>
<td>Unique identifier for the payment in the context of the merchant. Has to be unique.</td>
<td>STAMP</td>
<td>unique_id</td>
</tr>
<tr>
<td>3</td>
<td>Payment reference number for the payment from the merchant.</td>
<td>REFERENCE</td>
<td>standard_reference</td>
</tr>
<tr>
<td>4</td>
<td>Payment archive id</td>
<td>PAYMENT</td>
<td>Checkouts unique ID for the payment.</td>
</tr>
<tr>
<td>5</td>
<td>Payment status</td>
<td>STATUS</td>
<td>2 = success</td>
</tr>
<tr>
<td>6 </td>
<td> Used algorithm. Use 3.</td>
<td>ALGORTH</td>
<td> 3</td>
</tr>
<tr>
<td>7</td>
<td>MAC check</td>
<td>MAC</td>
<td></td>
</tr>
</tbody></table>

<p>Responses checksum is calculated using HMAC SHA256 the following way:</p>

<p><code class="prettyprint">HASH_HMAC_SHA256(SECURITY_KEY, &quot;VERSION&amp;STAMP&amp;REFERENCE&amp;PAYMENT&amp;STATUS&amp;ALGORITHM&quot;)</code></p>

<p>Field separator is the <code class="prettyprint">&amp;</code>-sign.</p>

<blockquote>
<p>Example of implementing the check from the demo1.checkout.fi/xml2.txt</p>
</blockquote>
<pre class="highlight php"><code>$generatedMac=strtoupper(hash_hmac("sha256","{$data['VERSION']}<span class="ni">&amp;{$data['STAMP']}&amp;{$data['REFERENCE']}&amp;{$data['PAYMENT']}&amp;{$data['STATUS']}&amp;{$data['ALGORITHM']}",$this-&gt;password));</span>
</code></pre>
<h3 id="payment-statuses">Payment Statuses</h3>

<table><thead>
<tr>
<th>Status</th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>-10</td>
<td>Payment refunded to the buyer</td>
</tr>
<tr>
<td>-4</td>
<td>Payment cannot be found</td>
</tr>
<tr>
<td>-3</td>
<td>Payment timeout</td>
</tr>
<tr>
<td>-2</td>
<td>Payment cancelled by Checkout or payment method provider</td>
</tr>
<tr>
<td>-1</td>
<td>Payment cancelled by buyer</td>
</tr>
<tr>
<td>1 </td>
<td>Payment pending</td>
</tr>
<tr>
<td>2</td>
<td> Payment approved</td>
</tr>
<tr>
<td>3</td>
<td>Payment delayed</td>
</tr>
<tr>
<td>4</td>
<td>This status is saved for future additions. Works like status 3.</td>
</tr>
<tr>
<td>5</td>
<td>This status is saved for future additions. Approved payment.</td>
</tr>
<tr>
<td>6</td>
<td>Payment frozen</td>
</tr>
<tr>
<td>7</td>
<td> Payment method provider has accepted payment and it required approval</td>
</tr>
<tr>
<td> 8</td>
<td> Payment method provider has accepted payment and it has been approved</td>
</tr>
<tr>
<td>9</td>
<td>This status is saved for future additions.</td>
</tr>
<tr>
<td>10</td>
<td>Payment settled</td>
</tr>
</tbody></table>

<ul>
<li>Payment has been charged or is approved when the payment is in statuses: 2, 4, 5, 6, 7, 8, 9, 10.</li>
<li>Retailer or a merchant can approve the order when the status is 2, 5, 6, 7, 8, 9 or 10.</li>
</ul>

<h2 id="shop-in-shop-payment">Shop-in-shop payment</h2>

<p>Payments for shop-in-shop customers. Includes &ldquo;aggregate merchant&rdquo; (master merchant) and items with submerchants.
Making SiS-payments with single items/submerchants is ok.</p>

<p>If credit card token is sent to PaymentAPI, the API will use tokenized card for payment. If no token is sent, the user will be guided to credit card information input (payment).</p>

<p>Commit can be used with token-payments. If commit is true, the tokenized credit card will be charged. If commit is false, it will make a payment reservation (authorization hold) on the card. This authorization hold will be committed or retracted later through the &#39;commit payment&rsquo; or &#39;retract payment&rsquo; API&rsquo;s.</p>

<p>Actual HTTP request is made using two name/value pairs containing</p>

<blockquote>
<p>HTTP-request</p>
</blockquote>
<pre class="highlight plaintext"><code>POST / HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

CHECKOUT_XML=&lt;base64 encoded xml string&gt;&amp;CHECKOUT_MAC=&lt;string&gt;
</code></pre>
<h3 id="http-request">HTTP Request</h3>

<ul>
<li><code class="prettyprint">POST</code>: https://payment.checkout.fi</li>
</ul>

<table><thead>
<tr>
<th>Name</th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>CHECKOUT_MAC</td>
<td>MD5 hash calculated from sent values</td>
</tr>
<tr>
<td>CHECKOUT_XML</td>
<td>Base64 encoded representation of the XML string. XML explained below</td>
</tr>
</tbody></table>

<p>Calculating MD5 hash for CHECKOUT_MAC field:</p>

<p>strtoupper(md5(&lt;xml_string&gt; + &rsquo;+&rsquo; + &lt;aggregator_merchant_secret&gt;))</p>

<p>! Note the plus sign between strings is part of a string not concatenating operator etc.</p>

<blockquote>
<p>Create SiS payment XML format</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;checkout</span> <span class="na">xmlns=</span><span class="s">"http://checkout.fi/request"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;request</span> <span class="na">type=</span><span class="s">"aggregator"</span> <span class="na">test=</span><span class="s">"false"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aggregator&gt;&lt;/aggregator&gt;</span>
      <span class="nt">&lt;version&gt;&lt;/version&gt;</span>
      <span class="nt">&lt;stamp&gt;&lt;/stamp&gt;</span>
      <span class="nt">&lt;reference&gt;&lt;/reference&gt;</span>
      <span class="nt">&lt;description&gt;&lt;/description&gt;</span>
      <span class="nt">&lt;device&gt;&lt;/device&gt;</span>
      <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
      <span class="nt">&lt;type&gt;&lt;/type&gt;</span>
      <span class="nt">&lt;algorithm&gt;&lt;/algorithm&gt;</span>
      <span class="nt">&lt;currency&gt;&lt;/currency&gt;</span>
      <span class="nt">&lt;token&gt;&lt;/token&gt;</span>
      <span class="nt">&lt;commit&gt;&lt;/commit&gt;</span>
      <span class="nt">&lt;items&gt;</span>
          <span class="nt">&lt;item&gt;</span>
              <span class="nt">&lt;code&gt;&lt;/code&gt;</span>
              <span class="nt">&lt;stamp&gt;&lt;/stamp&gt;</span>
              <span class="nt">&lt;description&gt;&lt;/description&gt;</span>
              <span class="nt">&lt;price</span> <span class="na">currency=</span><span class="s">"EUR"</span> <span class="na">vat=</span><span class="s">"23"</span><span class="nt">&gt;&lt;/price&gt;</span>
              <span class="nt">&lt;merchant&gt;&lt;/merchant&gt;</span>
              <span class="nt">&lt;control&gt;&lt;/control&gt;</span>
              <span class="nt">&lt;reference&gt;&lt;/reference&gt;</span>
          <span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;amount</span> <span class="na">currency=</span><span class="s">"EUR"</span><span class="nt">&gt;&lt;/amount&gt;</span>
      <span class="nt">&lt;/items&gt;</span>
      <span class="nt">&lt;buyer&gt;</span>
          <span class="nt">&lt;company</span> <span class="na">vatid=</span><span class="s">""</span><span class="nt">&gt;&lt;/company&gt;</span>
          <span class="nt">&lt;firstname&gt;&lt;/firstname&gt;</span>
          <span class="nt">&lt;familyname&gt;&lt;/familyname&gt;</span>
          <span class="nt">&lt;address&gt;</span><span class="cp">&lt;![CDATA[ ]]&gt;</span><span class="nt">&lt;/address&gt;</span>
          <span class="nt">&lt;postalcode&gt;&lt;/postalcode&gt;</span>
          <span class="nt">&lt;postaloffice&gt;&lt;/postaloffice&gt;</span>
          <span class="nt">&lt;country&gt;&lt;/country&gt;</span>
          <span class="nt">&lt;email&gt;&lt;/email&gt;</span>
          <span class="nt">&lt;gsm&gt;&lt;/gsm&gt;</span>
          <span class="nt">&lt;language&gt;&lt;/language&gt;</span>
      <span class="nt">&lt;/buyer&gt;</span>
      <span class="nt">&lt;delivery&gt;</span>
          <span class="nt">&lt;date&gt;&lt;/date&gt;</span>
          <span class="nt">&lt;company</span> <span class="na">vatid=</span><span class="s">""</span><span class="nt">&gt;&lt;/company&gt;</span>
          <span class="nt">&lt;firstname&gt;&lt;/firstname&gt;</span>
          <span class="nt">&lt;familyname&gt;&lt;/familyname&gt;</span>
          <span class="nt">&lt;address&gt;</span><span class="cp">&lt;![CDATA[ ]]&gt;</span><span class="nt">&lt;/address&gt;</span>
          <span class="nt">&lt;postalcode&gt;&lt;/postalcode&gt;</span>
          <span class="nt">&lt;postaloffice&gt;&lt;/postaloffice&gt;</span>
          <span class="nt">&lt;country&gt;&lt;/country&gt;</span>
          <span class="nt">&lt;email&gt;&lt;/email&gt;</span>
          <span class="nt">&lt;gsm&gt;&lt;/gsm&gt;</span>
          <span class="nt">&lt;language&gt;&lt;/language&gt;</span>
      <span class="nt">&lt;/delivery&gt;</span>
      <span class="nt">&lt;control</span> <span class="na">type=</span><span class="s">"default"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;return&gt;&lt;/return&gt;</span>
          <span class="nt">&lt;reject&gt;&lt;/reject&gt;</span>
          <span class="nt">&lt;cancel&gt;&lt;/cancel&gt;</span>
      <span class="nt">&lt;/control&gt;</span>
  <span class="nt">&lt;/request&gt;</span>
<span class="nt">&lt;/checkout&gt;</span>
</code></pre>
<h3 id="xml-data">XML data</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>AGGREGATOR</td>
<td>Merchant Id of aggregate merchant. Given identifier for the merchant (you get this from Checkout Finland), for testing: 375917</td>
<td>375917</td>
<td>AN 20</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>VERSION</td>
<td>Payment version.<br /><code class="prettyprint">Always &quot;0002&quot;</code></td>
<td>&ldquo;0002&rdquo;</td>
<td>AN 4</td>
<td>&cross; </td>
<td></td>
</tr>
<tr>
<td>STAMP</td>
<td>Unique identifier for the payment in the context of the merchant. Has to be unique.</td>
<td>unique_id</td>
<td>AN 20</td>
<td>&cross; </td>
<td></td>
</tr>
<tr>
<td>REFERENCE</td>
<td>Payment reference number for the payment from the merchant.</td>
<td>standard_reference</td>
<td>AN 20</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>DESCRIPTION</td>
<td>Description of payment/purchase</td>
<td>&ldquo;Item 1#, Item #2&hellip;&rdquo;</td>
<td>AN 1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DEVICE</td>
<td>Device type<br /><code class="prettyprint">1 = HTML</code>, <code class="prettyprint">10 = XML</code></td>
<td>1</td>
<td>N 2</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>CONTENT</td>
<td>Content of the purchase.<br /><code class="prettyprint">1 = Normal</code>, <code class="prettyprint">2 = adult industry</code></td>
<td>1</td>
<td>N 2</td>
<td>(&cross;)</td>
<td>1</td>
</tr>
<tr>
<td>TYPE</td>
<td>Payment types. See payment types below.</td>
<td>0</td>
<td>N 1</td>
<td>(&cross;)</td>
<td>1</td>
</tr>
<tr>
<td>ALGORITHM</td>
<td>Checksum calculation algorithm. Use 3 commonly.</td>
<td>3</td>
<td>N 1</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>CURRENCY</td>
<td>Currency. Currently always EUR.</td>
<td>&ldquo;EUR&rdquo;</td>
<td>AN 3</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>TOKEN</td>
<td>Token of credit card used on tokenized payments</td>
<td>&ldquo;f47ac10b-58cc-4372-a567-0e02b2c3d479&rdquo;</td>
<td>UUID4</td>
<td>(&cross;)</td>
<td>2, 4</td>
</tr>
<tr>
<td>COMMIT</td>
<td>Commit token payment (if false, makes a reservation). Field is ignored if not tokenized payment. Default value is TRUE.</td>
<td>true/false</td>
<td>BOOL</td>
<td>(&cross;)</td>
<td>2</td>
</tr>
<tr>
<td>ITEMS</td>
<td><code class="prettyprint">Items</code> XML element</td>
<td>XML</td>
<td>XML</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>BUYER</td>
<td><code class="prettyprint">Buyer</code> XML element</td>
<td>XML</td>
<td>XML</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>DELIVERY</td>
<td><code class="prettyprint">Delivery</code> XML element</td>
<td>XML</td>
<td>XML</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>CONTROL</td>
<td><code class="prettyprint">Control</code> XML element</td>
<td>XML</td>
<td>XML</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>REFERENCE</td>
<td>Item level <code class="prettyprint">Reference</code>. Used when refunding payments, must be unique if used.</td>
<td>ABCDE1234</td>
<td>AN</td>
<td>(&cross;)</td>
<td></td>
</tr>
</tbody></table>

<!--
Are these relevat to this API???
| Delayed callback. Called if the payment is delayed. | DELAYED | | AN 300 | | |
| Checksum is calculated by combining fields 1-23 and the secret key, separating them with a `+`-sign  | MAC |  | AN 32 | &cross; | 2 |
-->

<p><em>Note 1.)</em> Required only with non-token -payments.</p>

<p><em>Note 2.)</em> Required only on tokenized payments</p>

<p><em>Note 3.)</em> For calculating checksum, check above on Payment-API.</p>

<p><em>Note 4.)</em> Must match ^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-(8|9|a|b)[a-f0-9]{3}-[a-f0-9]{12}$</p>

<h3 id="xml-element-items">XML-element : Items</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>ITEM</td>
<td>1 to n <code class="prettyprint">Item</code> XML elements</td>
<td>XML</td>
<td>XML</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>AMOUNT</td>
<td>Amount in cents. Has to be exact total from sum of the items prices</td>
<td>1000</td>
<td>N</td>
<td>&cross;</td>
<td></td>
</tr>
</tbody></table>

<h3 id="xml-element-item">XML-element : Item</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>DESCRIPTION</td>
<td>Description of payment/purchase</td>
<td>&ldquo;Product #1&rdquo;</td>
<td>AN</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>PRICE</td>
<td>Price of item in cents</td>
<td>50</td>
<td>N</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>MERCHANT</td>
<td>Merchant id of the shop selling the item (SiS-shop)</td>
<td>585858</td>
<td>N</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>CONTROL</td>
<td>Holds a list of JSON objects that define the commission which SiS-merchant will receive. Not required if no commission given to SiS-merchant</td>
<td></td>
<td>JSON</td>
<td>(&cross;)</td>
<td>1</td>
</tr>
<tr>
<td>CODE</td>
<td>Product id/sku/code</td>
<td></td>
<td>AN</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p><em>Note 1.)</em> Required if commissions are to be deducted</p>

<h3 id="json-object-in-item-control-field">JSON object in Item.control field</h3>

<blockquote>
<p>JSON data in ITEMS.ITEM.CONTROL field</p>
</blockquote>
<pre class="highlight plaintext"><code>[
    {
    a : &lt;amountm in euro cents&gt;,
    m : &lt;merchant id&gt;,
    d : &lt;description&gt;
    }
]
</code></pre>
<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>a</td>
<td>Amount of commission in cents</td>
<td>48</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>m</td>
<td>Merchant ID, that will receive the commission from the payment (usually same as ITEM.MERCHANT)</td>
<td>585858</td>
<td>N</td>
<td></td>
<td></td>
</tr>
<tr>
<td>d</td>
<td>Message/description of payment</td>
<td>&ldquo;commission for item #1&rdquo;</td>
<td>AN</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<h3 id="payment-types">Payment types</h3>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>0</td>
<td>Normal payment</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>Shop in shop payment</td>
<td></td>
</tr>
</tbody></table>

<h3 id="xml-element-buyer">XML-element : Buyer</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>FIRSTNAME</td>
<td>Required when using loaning services. First name of the buyer.</td>
<td>&ldquo;Matti&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>FAMILYNAME</td>
<td>Required when using loaning services. Last name of the buyer.</td>
<td>&ldquo;Meikäläinen&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ADDRESS</td>
<td>Required when using loaning services. Delivery address.</td>
<td>&ldquo;Maantie 123&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>POSTCODE</td>
<td>Required when using loaning services. Delivery post number.</td>
<td>&ldquo;12345&rdquo;</td>
<td>AN 14</td>
<td></td>
<td></td>
</tr>
<tr>
<td>POSTOFFICE</td>
<td>Required when using loaning services. Delivery postal office.</td>
<td>&ldquo;&rdquo;</td>
<td>AN 18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>COUNTRY</td>
<td>Country, ISO-3166-1 alpha-3.</td>
<td>&ldquo;FIN&rdquo;</td>
<td>AN 3</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>EMAIL</td>
<td>Buyer email</td>
<td></td>
<td>AN 200</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>PHONE</td>
<td>Buyer phone number</td>
<td></td>
<td>AN 30</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>LANGUAGE</td>
<td>Payment language. Options currently are: &ldquo;FI&rdquo;, &ldquo;EN&rdquo;, &ldquo;SE&rdquo;.</td>
<td>&ldquo;FI&rdquo;</td>
<td>AN 2</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<h3 id="xml-element-delivery">XML-element : Delivery</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>DATE</td>
<td>Delivery date. Format: YYYYMMDD.</td>
<td>20171231</td>
<td>N 8</td>
<td>&cross;</td>
<td></td>
</tr>
<tr>
<td>FIRSTNAME</td>
<td>Required when using loaning services. First name of the buyer.</td>
<td>&ldquo;Matti&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>FAMILYNAME</td>
<td>Required when using loaning services. Last name of the buyer.</td>
<td>&ldquo;Meikäläinen&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ADDRESS</td>
<td>Required when using loaning services. Delivery address.</td>
<td>&ldquo;Maantie 123&rdquo;</td>
<td>AN 40</td>
<td></td>
<td></td>
</tr>
<tr>
<td>POSTCODE</td>
<td>Required when using loaning services. Delivery post number.</td>
<td>&ldquo;12345&rdquo;</td>
<td>AN 14</td>
<td></td>
<td></td>
</tr>
<tr>
<td>POSTOFFICE</td>
<td>Required when using loaning services. Delivery postal office.</td>
<td>&ldquo;&rdquo;</td>
<td>AN 18</td>
<td></td>
<td></td>
</tr>
<tr>
<td>COUNTRY</td>
<td>Country, ISO-3166-1 alpha-3.</td>
<td>&ldquo;FIN&rdquo;</td>
<td>AN 3</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>EMAIL</td>
<td>Buyer email</td>
<td></td>
<td>AN 200</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>PHONE</td>
<td>Buyer phone number</td>
<td></td>
<td>AN 30</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>LANGUAGE</td>
<td>Payment language. Options currently are: &ldquo;FI&rdquo;, &ldquo;EN&rdquo;, &ldquo;SE&rdquo;.</td>
<td>&ldquo;FI&rdquo;</td>
<td>AN 2</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<h3 id="xml-element-control">XML-element : Control</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Value</th>
<th>Format</th>
<th>Required</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>RETURN</td>
<td>Return callback. Called when the payment is successfully paid.</td>
<td></td>
<td>AN 300</td>
<td>&cross; *</td>
<td>1</td>
</tr>
<tr>
<td>CANCEL</td>
<td>Cancel callback. Called when the payment is cancelled for some reason.</td>
<td></td>
<td>AN 300</td>
<td>&cross; *</td>
<td>1</td>
</tr>
<tr>
<td>REJECT</td>
<td>Reject callback. Called when the payment is rejected. If not defined, on reject the cancel will be called.</td>
<td></td>
<td>AN 300</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<blockquote>
<p>Response XML</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
    <span class="nt">&lt;statusCode&gt;&lt;/statusCode&gt;</span>
    <span class="nt">&lt;statusText&gt;&lt;/statusText&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<h3 id="response-body-xml">Response body (XML)</h3>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Format</th>
</tr>
</thead><tbody>
<tr>
<td>statusCode</td>
<td>HTTP Status code (200 if payment/reservation successful)</td>
<td>N</td>
</tr>
<tr>
<td>statusText</td>
<td>Status text (e.g. &#39;payment done&rsquo;)</td>
<td>AN</td>
</tr>
</tbody></table>

<h3 id="response-status-codes">Response status codes</h3>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>OK, payment committed</td>
</tr>
<tr>
<td>201</td>
<td>OK, authorization hold created</td>
</tr>
<tr>
<td>400</td>
<td>Aggregator not found</td>
</tr>
<tr>
<td>401</td>
<td>Merchant has no aggregator status</td>
</tr>
<tr>
<td>402</td>
<td>Invalid merchant id</td>
</tr>
<tr>
<td>403</td>
<td>Merchant not found</td>
</tr>
<tr>
<td>404</td>
<td>Amounts wont match</td>
</tr>
<tr>
<td>405</td>
<td>Trade amount is 0 or less</td>
</tr>
<tr>
<td>406</td>
<td>Token not found</td>
</tr>
<tr>
<td>500</td>
<td>Error parsing XML</td>
</tr>
<tr>
<td>502</td>
<td>Creating a trade failed (&lt;errcode&gt;)</td>
</tr>
<tr>
<td>503</td>
<td>Failed creating new trade</td>
</tr>
<tr>
<td>504</td>
<td>Aggregate can&rsquo;t buy from self</td>
</tr>
<tr>
<td>505</td>
<td>Failed to get payment archive ID : &lt;detailed information&gt;</td>
</tr>
<tr>
<td>506</td>
<td>Authorization failed or unable to create a debit transaction</td>
</tr>
<tr>
<td>507</td>
<td>Failed : &lt;detailed information&gt;</td>
</tr>
</tbody></table>

<h2 id="retract-authorization-hold">Retract authorization hold</h2>

<p>Retracts (deletes) an existing authorization hold.</p>

<h3 id="http-request">HTTP Request</h3>
<pre class="highlight plaintext"><code>POST /token/payment/retract HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

stamp=1492599660&amp;hmac=3BB1330F9A90BBEBDB586EA58CDE70F2A1DB8870E5A71DF868384F14916377D2&amp;merchant=375917
</code></pre>
<p><code class="prettyprint">POST https://payment.checkout.fi/token/payment/retract</code></p>

<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>merchant</td>
<td>N</td>
<td>Merchant id of which the initial reservation was done with</td>
<td></td>
</tr>
<tr>
<td>stamp</td>
<td>AN 20</td>
<td>Stamp id of the initial token payment</td>
<td></td>
</tr>
<tr>
<td>hmac</td>
<td>AN</td>
<td>Calculated HMAC, <a href="#hmac-calculation">instructions</a></td>
<td></td>
</tr>
</tbody></table>

<h3 id="http-response">HTTP Response</h3>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
    <span class="nt">&lt;statusCode&gt;</span>200<span class="nt">&lt;/statusCode&gt;</span>
    <span class="nt">&lt;statusText&gt;</span>Authorization hold retracted.<span class="nt">&lt;/statusText&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>statusCode</td>
<td>SCODE</td>
<td>Checkout status code, described in table below</td>
</tr>
<tr>
<td>statusText</td>
<td>AN</td>
<td>Status message</td>
</tr>
</tbody></table>

<h4 id="status-codes-amp-texts">Status codes &amp; -texts</h4>

<table><thead>
<tr>
<th>Status Code</th>
<th>Status Text</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Authorization hold retracted.</td>
</tr>
<tr>
<td>400</td>
<td>Merchant with given ID not found.</td>
</tr>
<tr>
<td>401</td>
<td>No trade with given merchant/stamp found.</td>
</tr>
<tr>
<td>402</td>
<td>Payment has been committed.</td>
</tr>
<tr>
<td>403</td>
<td>Authorization hold has already been reverted.</td>
</tr>
<tr>
<td>500</td>
<td>No transactions found.</td>
</tr>
<tr>
<td>501</td>
<td>Error fetching trade status.</td>
</tr>
<tr>
<td>502</td>
<td>Error while fetching transaction ID.</td>
</tr>
<tr>
<td>503</td>
<td>Error parsing response.</td>
</tr>
<tr>
<td>504</td>
<td>Error while fetching result.</td>
</tr>
<tr>
<td>505</td>
<td>Error while reverting.</td>
</tr>
<tr>
<td>600</td>
<td>Missing required parameters.</td>
</tr>
<tr>
<td>700</td>
<td>Invalid HMAC.</td>
</tr>
</tbody></table>

<h2 id="commit-payment">Commit payment</h2>

<p>Commits an existing credit card reservation.</p>

<h3 id="http-request">HTTP Request</h3>
<pre class="highlight plaintext"><code>POST /token/payment/commit HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

stamp=1492599660&amp;hmac=104150D231401BDEB01F3E62B6FB32812C8314E3C0E9D10CB2749215FA0777D2&amp;merchant=375917&amp;amount=50
</code></pre>
<p><code class="prettyprint">POST https://payment.checkout.fi/token/payment/commit</code></p>

<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>merchant</td>
<td>N</td>
<td>Merchant id of which the initial reservation was done with</td>
<td></td>
</tr>
<tr>
<td>stamp</td>
<td>AN 20</td>
<td>Stamp id of the initial token payment</td>
<td></td>
</tr>
<tr>
<td>amount</td>
<td>N</td>
<td>Amount of payment reservation to be committed (cents)</td>
<td>1</td>
</tr>
<tr>
<td>hmac</td>
<td>AN</td>
<td>Calculated HMAC, <a href="#hmac-calculation">instructions</a></td>
<td></td>
</tr>
</tbody></table>

<p><em>Note 1.)</em> Must be less than or equal to initial authorization hold amount</p>

<h3 id="http-response">HTTP Response</h3>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
    <span class="nt">&lt;statusCode&gt;</span>200<span class="nt">&lt;/statusCode&gt;</span>
    <span class="nt">&lt;statusText&gt;</span>Payment committed.<span class="nt">&lt;/statusText&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>statusCode</td>
<td>SCODE</td>
<td>Checkout status code, described in table below</td>
</tr>
<tr>
<td>statusText</td>
<td>AN</td>
<td>Status message</td>
</tr>
</tbody></table>

<h3 id="status-codes-amp-texts">Status codes &amp; -texts</h3>

<table><thead>
<tr>
<th>Status Code</th>
<th>Status Text</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Payment committed.</td>
</tr>
<tr>
<td>400</td>
<td>Merchant with given ID not found.</td>
</tr>
<tr>
<td>401</td>
<td>No trade with given merchant/stamp found.</td>
</tr>
<tr>
<td>402</td>
<td>Payment has already been committed.</td>
</tr>
<tr>
<td>403</td>
<td>Commit amount larger than authorization hold.</td>
</tr>
<tr>
<td>404</td>
<td>Cancelled payment cannot be committed.</td>
</tr>
<tr>
<td>405</td>
<td>Problem with commit : &lt;detailed information&gt;</td>
</tr>
<tr>
<td>406</td>
<td>Negative commit amount not allowed.</td>
</tr>
<tr>
<td>500</td>
<td>No transactions found.</td>
</tr>
<tr>
<td>501</td>
<td>Error fetching trade status.</td>
</tr>
<tr>
<td>502</td>
<td>Error while fetching transaction ID.</td>
</tr>
<tr>
<td>503</td>
<td>Error parsing response.</td>
</tr>
<tr>
<td>504</td>
<td>Error while fetching result.</td>
</tr>
<tr>
<td>505</td>
<td>Error while committing.</td>
</tr>
<tr>
<td>506</td>
<td>Error committing payment : &lt;detailed information&gt;</td>
</tr>
<tr>
<td>600</td>
<td>Missing required parameters.</td>
</tr>
<tr>
<td>700</td>
<td>Invalid HMAC.</td>
</tr>
</tbody></table>

<h2 id="fetch-trade-info">Fetch trade info</h2>

<p>Fetches info &amp; status of trade.</p>

<h3 id="http-request">HTTP Request</h3>
<pre class="highlight plaintext"><code>POST /token/payment/info HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

stamp=1492599660&amp;merchant=375917&amp;hmac=3BB1330F9A90BBEBDB586EA58CDE70F2A1DB8870E5A71DF868384F14916377D2
</code></pre>
<p><code class="prettyprint">POST https://payment.checkout.fi/token/payment/info</code></p>

<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td>merchant</td>
<td>N</td>
<td>Merchant id of which the initial reservation was done with</td>
<td></td>
</tr>
<tr>
<td>stamp</td>
<td>AN 20</td>
<td>Stamp id of the initial token payment</td>
<td></td>
</tr>
<tr>
<td>hmac</td>
<td>AN</td>
<td>Calculated HMAC, <a href="#hmac-calculation">instructions</a></td>
<td></td>
</tr>
</tbody></table>

<h3 id="http-response">HTTP Response</h3>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
    <span class="nt">&lt;statusCode&gt;</span>200<span class="nt">&lt;/statusCode&gt;</span>
    <span class="nt">&lt;statusText&gt;</span>Payment information fetched.<span class="nt">&lt;/statusText&gt;</span>
    <span class="nt">&lt;payment&gt;</span>
        <span class="nt">&lt;status&gt;</span>reverted<span class="nt">&lt;/status&gt;</span>
        <span class="nt">&lt;currentAmount&gt;</span>0<span class="nt">&lt;/currentAmount&gt;</span>
        <span class="nt">&lt;initialAmount&gt;</span>100<span class="nt">&lt;/initialAmount&gt;</span>
        <span class="nt">&lt;createdTime&gt;</span>2017-04-19T11:01:01Z<span class="nt">&lt;/createdTime&gt;</span>
        <span class="nt">&lt;modifiedTime&gt;</span>2017-04-19T11:13:34Z<span class="nt">&lt;/modifiedTime&gt;</span>
        <span class="nt">&lt;currency&gt;</span>EUR<span class="nt">&lt;/currency&gt;</span>
    <span class="nt">&lt;/payment&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<table><thead>
<tr>
<th>Body field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>statusCode</td>
<td>SCODE</td>
<td>Checkout status code, described in table below</td>
</tr>
<tr>
<td>statusText</td>
<td>AN</td>
<td>Status message</td>
</tr>
<tr>
<td>payment</td>
<td></td>
<td>Object including info-fields</td>
</tr>
<tr>
<td>payment.status</td>
<td>AN</td>
<td>Status of trade, e.g. &#39;committed&rsquo;, &#39;reverted&rsquo;</td>
</tr>
<tr>
<td>payment.currentAmount</td>
<td>AMOUNT</td>
<td>Current amount of trade in cents (e.g. if committed with amount 50, then 50)</td>
</tr>
<tr>
<td>payment.initialAmount</td>
<td>AMOUNT</td>
<td>Initial amount of trade in cents (amount which trade was originally created with)</td>
</tr>
<tr>
<td>payment.createdTime</td>
<td>N</td>
<td>Timestamp of when trade was created</td>
</tr>
<tr>
<td>payment.modifiedTime</td>
<td>N</td>
<td>Timestamp when trade was last modified</td>
</tr>
<tr>
<td>payment.currency</td>
<td>CURRENCY</td>
<td>Currency with which trade was created, e.g. &ldquo;EUR&rdquo;</td>
</tr>
</tbody></table>

<h3 id="status-codes-amp-texts">Status codes &amp; -texts</h3>

<table><thead>
<tr>
<th>Status Code</th>
<th>Status Text</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Payment information fetched.</td>
</tr>
<tr>
<td>400</td>
<td>Merchant with given ID not found.</td>
</tr>
<tr>
<td>401</td>
<td>No trade with given merchant/stamp found.</td>
</tr>
<tr>
<td>500</td>
<td>No transactions found.</td>
</tr>
<tr>
<td>501</td>
<td>Information fetching failed.</td>
</tr>
<tr>
<td>600</td>
<td>Missing required parameters.</td>
</tr>
<tr>
<td>700</td>
<td>Invalid HMAC.</td>
</tr>
</tbody></table>

<h2 id="refund">Refund</h2>

<p>Creates a refund for succeeded charge or already committed authorization hold.</p>

<h3 id="http-request">HTTP request</h3>

<ul>
<li><code class="prettyprint">POST</code>: https://rpcapi.checkout.fi/refund2</li>
</ul>

<!--
### HTTP Request

```
POST /token/payment/info HTTP/1.1
Host: payment.checkout.fi
Content-Type: application/x-www-form-urlencoded
Cache-Control: no-cache

stamp=1492599660&merchant=375917&hmac=3BB1330F9A90BBEBDB586EA58CDE70F2A1DB8870E5A71DF868384F14916377D2
```
-->

<h3 id="field-descriptions">Field descriptions</h3>

<blockquote>
<p>Example of the sent XML that gets base64 encoded</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="nt">&lt;checkout&gt;</span>
 <span class="nt">&lt;identification&gt;</span>
  <span class="nt">&lt;merchant&gt;</span>1234<span class="nt">&lt;/merchant&gt;</span> <span class="c">&lt;!-- merchant id --&gt;</span>
  <span class="nt">&lt;stamp&gt;</span>123456<span class="nt">&lt;/stamp&gt;</span> <span class="c">&lt;!-- message unique identifier --&gt;</span>
 <span class="nt">&lt;/identification&gt;</span>
 <span class="nt">&lt;message&gt;</span>
  <span class="nt">&lt;refund&gt;</span>
   <span class="nt">&lt;stamp&gt;</span>12345<span class="nt">&lt;/stamp&gt;</span> <span class="c">&lt;!-- refund payment unique identifier  --&gt;</span>
   <span class="nt">&lt;reference&gt;</span>12345<span class="nt">&lt;/reference&gt;</span> <span class="c">&lt;!-- reference for the payment refund --&gt;</span>
   <span class="nt">&lt;amount&gt;</span>1245<span class="nt">&lt;/amount&gt;</span> <span class="c">&lt;!-- sum in cents --&gt;</span>
   <span class="nt">&lt;receiver&gt;</span>
     <span class="nt">&lt;email&gt;</span>email@osoi.te<span class="nt">&lt;/email&gt;</span>
   <span class="nt">&lt;/receiver&gt;</span>
  <span class="nt">&lt;/refund&gt;</span>
 <span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/checkout&gt;</span>
</code></pre>
<blockquote>
<p>Example of calculating the MD5</p>
</blockquote>
<pre class="highlight php"><code>$messageMac=strtoupper(hash_hmac("sha256", base64_encode($message), $secretKey));
</code></pre>
<table><thead>
<tr>
<th>Description</th>
<th>Field</th>
<th>Format</th>
<th> Required</th>
</tr>
</thead><tbody>
<tr>
<td>Contains the base64 encoded XML.</td>
<td>data</td>
<td>AN</td>
<td>Yes</td>
</tr>
<tr>
<td>Mac checksum of the data.</td>
<td>mac</td>
<td>AN</td>
<td>Yes</td>
</tr>
</tbody></table>

<h3 id="response-status-codes-and-messages">Response status codes and messages</h3>

<table><thead>
<tr>
<th>code</th>
<th> message</th>
</tr>
</thead><tbody>
<tr>
<td>2100</td>
<td>REFUNDED</td>
</tr>
<tr>
<td>1200</td>
<td>CHECKSUM MISMATCH</td>
</tr>
<tr>
<td>1201</td>
<td>DATA FIELD IS MISSING</td>
</tr>
<tr>
<td>1202</td>
<td>MAC FIELD IS MISSING</td>
</tr>
<tr>
<td>1203</td>
<td>DATA NOT BASE64 ENCODED STRING</td>
</tr>
<tr>
<td>1204</td>
<td>MAC FORMAT ERROR</td>
</tr>
<tr>
<td>2200</td>
<td>TRADE NOT FOUND</td>
</tr>
<tr>
<td>2201</td>
<td>TRADE ALREADY REFUNDED</td>
</tr>
<tr>
<td>2202</td>
<td>REFUND AMOUNT TOO BIG</td>
</tr>
<tr>
<td>2203</td>
<td>MERCHANT BALANCE TOO LOW</td>
</tr>
<tr>
<td>2204</td>
<td>ACCOUNT NOT ACCEPTED</td>
</tr>
<tr>
<td>2205</td>
<td>REFUND AMOUNT TOO LOW</td>
</tr>
<tr>
<td>2209</td>
<td>AMOUNT NOT INTEGER</td>
</tr>
<tr>
<td>2220</td>
<td>GENERIC ERROR</td>
</tr>
<tr>
<td>2221</td>
<td>UNKNOWN ERROR</td>
</tr>
</tbody></table>

<!--12515 | COMPANY NOT FOUND-->

<blockquote>
<p>Example response</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="nt">&lt;checkout&gt;</span>
 <span class="nt">&lt;response&gt;</span>
  <span class="nt">&lt;stamp&gt;</span>12345<span class="nt">&lt;/stamp&gt;</span>
  <span class="nt">&lt;statusMessage&gt;</span>REFUNDED<span class="nt">&lt;/statusMessage&gt;</span>
  <span class="nt">&lt;statusCode&gt;</span>2100<span class="nt">&lt;/statusCode&gt;</span>
  <span class="nt">&lt;/response&gt;</span>
<span class="nt">&lt;/checkout&gt;</span>";
</code></pre>
<h1 id="polling-api">Polling API</h1>

<h2 id="polling">Polling</h2>
<pre class="highlight plaintext"><code>&lt;?php

// this example code can be run in a terminal, but current payment values are not valid

$url            = 'https://rpcapi.checkout.fi/poll';

$merchant_id    = '375917';
$secret         = 'SAIPPUAKAUPPIAS';

$stamp          = '100'; // Stamp generated generated by webshop when creating the payment
$reference      = '100'; // Refence number generated by webshop when creating the payment
$amount         = '100'; // Amount in cents 1€ = 100

$formdata = [
    'VERSION'       =&gt; '0001',  //Normal payment version is 0001, 0002 is used for shop-in-shop payments    'STAMP'         =&gt; $stamp,
    'REFERENCE'     =&gt; $reference,
    'MERCHANT'      =&gt; $merchant_id,
    'AMOUNT'        =&gt; $amount,
    'CURRENCY'      =&gt; 'EUR',
    'FORMAT'        =&gt; '1',
    'ALGORITHM'     =&gt; '1'
];

$formdata['MAC'] = strtoupper(md5(implode('+', $formdata) . "+{$secret}"));


$options = array(
    CURLOPT_POST            =&gt; 1,
    CURLOPT_HEADER          =&gt; 0,
    CURLOPT_URL             =&gt; $url,
    CURLOPT_FRESH_CONNECT   =&gt; 1,
    CURLOPT_RETURNTRANSFER  =&gt; 1,
    CURLOPT_FORBID_REUSE    =&gt; 1,
    CURLOPT_TIMEOUT         =&gt; 4,
    CURLOPT_POSTFIELDS      =&gt; http_build_query($formdata)
);

$ch = curl_init();
curl_setopt_array($ch, $options);
$result = curl_exec($ch);

curl_close($ch);

echo "\n";

var_dump($result);

echo "\n";
echo strtoupper(md5(implode('+', $formdata) . "+{$secret}"));
echo "\n";
</code></pre>
<p>Responds with the current status of the payment, can be used to verify success or failure of a payment when</p>

<p>request URL: https://rpcapi.checkout.fi/poll</p>

<p>method = post</p>

<p>Field values</p>

<table><thead>
<tr>
<th>Field</th>
<th>Name</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>Version of API used</td>
<td>VERSION</td>
<td>001=standard payment 002=shop-in-shop payment</td>
</tr>
<tr>
<td>Unique stamp generated when payment was created</td>
<td>STAMP</td>
<td>value generated by web shop</td>
</tr>
<tr>
<td>Web shops reference code generated when payment was created</td>
<td>REFERENCE</td>
<td>value generated by web shop</td>
</tr>
<tr>
<td>Merchant ID</td>
<td>MERCHANT</td>
<td>merchant ID number assigned by Checkout Finland</td>
</tr>
<tr>
<td>Payment total amount</td>
<td>AMOUNT</td>
<td>total amount in cents 1€=100</td>
</tr>
<tr>
<td>Currency used</td>
<td>CURRENCY</td>
<td>EUR (only euros are currently supported)</td>
</tr>
<tr>
<td>Format for response</td>
<td>FORMAT</td>
<td>1 (only one format is currently available)</td>
</tr>
<tr>
<td>Algorithm</td>
<td>ALGORITHM</td>
<td>1 (always &ldquo;1&rdquo; meaning MD5 algorithm)</td>
</tr>
<tr>
<td>Security hash</td>
<td>MAC</td>
<td>calculated using security key provided by Checkout Finland</td>
</tr>
</tbody></table>

<h2 id="poll-md5-hash-calculation">Poll MD5 hash calculation</h2>

<p>MD5 checksum calculation takes into account the fields 1-8 and secret key (aka merchant secret). Fields are separated with +-sign and text must be uppercase.</p>

<p><strong><em>MD5(VERSION+STAMP+REFERENCE+MERCHANT+AMOUNT+CURRENCY+
FORMAT+ALGORITHM+security key)</em></strong></p>

<h2 id="poll-response">Poll response</h2>

<p>A successful poll request will receive a XML file response.</p>
<pre class="highlight plaintext"><code>//Example response

&lt;?xml version=”1.0”?&gt;

&lt;trade&gt;
    &lt;status&gt;2&lt;/status&gt; //in this example payment has been succesful but not yet paid out by Checkout Finland
&lt;/trade&gt;
</code></pre>
<p>If the security hash or checksum of field values does not match Checkout Finlands database the API will respond with &ldquo;Error&rdquo;.</p>

<h1 id="data-types">Data types</h1>

<table><thead>
<tr>
<th>Type</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>N</td>
<td>^[0-9]+$</td>
<td>505050</td>
</tr>
<tr>
<td>AN</td>
<td>^[.,’-=/\w;\s]{0,1023}$</td>
<td>Alph4num3r1c</td>
</tr>
<tr>
<td>BOOL</td>
<td>true/false</td>
<td>true</td>
</tr>
<tr>
<td>AMOUNT</td>
<td>^\d{1,12}$</td>
<td>9000</td>
</tr>
<tr>
<td>CURRENCY</td>
<td>^(EUR)$</td>
<td>EUR</td>
</tr>
<tr>
<td>UUID4</td>
<td>^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$</td>
<td>f47ac10b-58cc-4372-a567-0e02b2c3d479</td>
</tr>
<tr>
<td>SCODE</td>
<td>^\d{1,6}$</td>
<td>9001</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>\d{4}-[0-1]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d+\d{4}</td>
<td>2017-04-19T11:01:01Z</td>
</tr>
<tr>
<td>JSON</td>
<td></td>
<td>[{a:1,b:2},{data:&#39;some text&rsquo;}]</td>
</tr>
<tr>
<td>XML</td>
<td></td>
<td>&lt;data&gt;Some data&lt;/data&gt;</td>
</tr>
</tbody></table>

<h1 id="hmac-calculation">HMAC-calculation</h1>

<p>If an API (e.g. <a href="#commit-payment">commit</a>, <a href="#retract-authorization-hold">retract</a>, <a href="#fetch-trade-info">trade info fetch</a>) requires the &#39;hmac&rsquo;-field, you must calculate it with SHA256 using the other request fields in alphabetized order + your own merchant-specific secret which is given to you by Checkout.</p>
<pre class="highlight javascript"><code><span class="cm">/*
 * Calculates SHA256 HMAC with given request parameters (which will be alphabetized for calculation)
 * and given secret string.
 *
 * The calculation string will be formed by combining key and value separated by ':'
 * and each key-value pair separated by newline.
 *
 * @param {[]} reqParams Array of request parameters.
 * @param {string} secret Merchant specific secret string.
 * @return {string} Calculated SHA256 HMAC string.
 */</span>
<span class="kd">function</span> <span class="nx">calculateHMAC</span><span class="p">(</span><span class="nx">reqParams</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">toHMAC</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">':'</span> <span class="o">+</span> <span class="nx">reqParams</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// separate the keys into a alphabetized array, leave out 'hmac'-field</span>
    <span class="kd">var</span> <span class="nx">sortedKeys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">reqParams</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">key</span> <span class="o">!==</span> <span class="s1">'hmac'</span><span class="p">;</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">macString</span> <span class="o">=</span> <span class="nx">sortedKeys</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">toHMAC</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span> <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>

    <span class="k">return</span> <span class="nb">Packages</span><span class="p">.</span><span class="nx">fi</span><span class="p">.</span><span class="nx">checkout</span><span class="p">.</span><span class="nx">tools</span><span class="p">.</span><span class="nx">HMac</span><span class="p">.</span><span class="nx">sha256</span><span class="p">(</span><span class="nx">macString</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
<span class="p">}</span>
</code></pre><pre class="highlight plaintext"><code>// Node.js example:
node -e "console.log(require('crypto').createHmac('sha256', 'merchantSecret').update('amount:50\nmerchant:375917\nstamp:1493200949').digest('hex'));"
</code></pre>
<p>Separate the key &amp; value of the request parameters with &rsquo;:&rsquo; and separate each parameter with a linebreak &rsquo;\n&rsquo;.</p>
<pre class="highlight plaintext"><code># if the request fields are for example 'merchant', 'stamp' &amp; 'amount, the final mac string used for calculation would be this:
"amount:50\nmerchant:375917\nstamp:1492599660"

The secret key used will be merchant-specific.
</code></pre>
<p>Leave the hmac-parameter itself out of the calculation.</p>

<h1 id="example-data-and-requests">Example data and requests</h1>

<h2 id="payment-api-usage-example-in-php">Payment API, usage example in PHP</h2>

<ul>
<li>https://payment.checkout.fi</li>
</ul>

<blockquote>
<p>Sample &#39;payment.xml&rsquo; file</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
    <span class="nt">&lt;checkout</span> <span class="na">xmlns=</span><span class="s">"http://checkout.fi/request"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;request</span> <span class="na">type=</span><span class="s">"aggregator"</span> <span class="na">test=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;aggregator&gt;</span>375917<span class="nt">&lt;/aggregator&gt;</span>
            <span class="nt">&lt;token&gt;</span>02343287-1e1a-4b92-8008-367e6ce35221<span class="nt">&lt;/token&gt;</span>
            <span class="nt">&lt;version&gt;</span>0002<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;stamp&gt;</span>123456789<span class="nt">&lt;/stamp&gt;</span>
            <span class="nt">&lt;reference&gt;</span>123456<span class="nt">&lt;/reference&gt;</span>
            <span class="nt">&lt;device&gt;</span>10<span class="nt">&lt;/device&gt;</span>
            <span class="nt">&lt;content&gt;</span>1<span class="nt">&lt;/content&gt;</span>
            <span class="nt">&lt;type&gt;</span>0<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;algorithm&gt;</span>3<span class="nt">&lt;/algorithm&gt;</span>
            <span class="nt">&lt;currency&gt;</span>EUR<span class="nt">&lt;/currency&gt;</span>
            <span class="nt">&lt;commit&gt;</span>false<span class="nt">&lt;/commit&gt;</span>
            <span class="nt">&lt;description&gt;</span>SiS tokenized payment test request<span class="nt">&lt;/description&gt;</span>
            <span class="nt">&lt;items&gt;</span>
                <span class="nt">&lt;item&gt;</span>
                    <span class="nt">&lt;code/&gt;</span>
                    <span class="nt">&lt;description&gt;</span>sub trade<span class="nt">&lt;/description&gt;</span>
                    <span class="nt">&lt;price</span> <span class="na">currency=</span><span class="s">"EUR"</span> <span class="na">vat=</span><span class="s">"23"</span><span class="nt">&gt;</span>2500<span class="nt">&lt;/price&gt;</span>
                    <span class="nt">&lt;merchant&gt;</span>391830<span class="nt">&lt;/merchant&gt;</span>
                    <span class="nt">&lt;control/&gt;</span>
                <span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;amount</span> <span class="na">currency=</span><span class="s">"EUR"</span><span class="nt">&gt;</span>2500<span class="nt">&lt;/amount&gt;</span>
            <span class="nt">&lt;/items&gt;</span>
            <span class="nt">&lt;buyer&gt;</span>
                <span class="nt">&lt;country&gt;</span>FIN<span class="nt">&lt;/country&gt;</span>
                <span class="nt">&lt;language&gt;</span>FI<span class="nt">&lt;/language&gt;</span>
            <span class="nt">&lt;/buyer&gt;</span>
            <span class="nt">&lt;delivery&gt;</span>
                <span class="nt">&lt;date&gt;</span>20170619<span class="nt">&lt;/date&gt;</span>
            <span class="nt">&lt;/delivery&gt;</span>
        <span class="nt">&lt;/request&gt;</span>
    <span class="nt">&lt;/checkout&gt;</span>
</code></pre>
<blockquote>
<p>PHP used to generate valid query from XML file (above)</p>
</blockquote>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="nv">$aggregatorMerchantSecret</span> <span class="o">=</span> <span class="s2">"SAIPPUAKAUPPIAS"</span><span class="p">;</span>

<span class="nv">$xml</span> <span class="o">=</span> <span class="nb">simplexml_load_file</span><span class="p">(</span><span class="s2">"payment.xml"</span><span class="p">);</span>
<span class="nv">$checkoutXML</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">asXML</span><span class="p">());</span>
<span class="nv">$checkoutMac</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">$checkoutXML</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="nv">$aggregatorMerchantSecret</span><span class="si">}</span><span class="s2">"</span><span class="p">));</span>

<span class="nv">$streamContext</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="s1">'http'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'method'</span> <span class="o">=&gt;</span> <span class="s1">'POST'</span><span class="p">,</span>
    <span class="s1">'header'</span> <span class="o">=&gt;</span> <span class="s1">'Content-Type: application/x-www-form-urlencoded'</span><span class="p">,</span>
    <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'CHECKOUT_XML'</span> <span class="o">=&gt;</span> <span class="nv">$checkoutXML</span><span class="p">,</span>
        <span class="s1">'CHECKOUT_MAC'</span> <span class="o">=&gt;</span> <span class="nv">$checkoutMac</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">),</span>
  <span class="s2">"ssl"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
      <span class="s2">"verify_peer"</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
      <span class="s2">"verify_peer_name"</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">)</span>
<span class="p">));</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'https://payment.checkout.fi/'</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">$streamContext</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Raw HTTP request sent to server</p>
</blockquote>
<pre class="highlight plaintext"><code>Host: payment.checkout.fi
Connection: close
Content-Length: 1567
Content-Type: application/x-www-form-urlencoded

CHECKOUT_XML=PD94bWwgdmVyc2lvbj0iMS4wIj8%2BCjxjaGVja291dCB4bWxucz0iaHR0cDovL2NoZWNrb3V0LmZpL3JlcXVlc3QiPgogICAgPHJlcXVlc3QgdHlwZT0iYWdncmVnYXRvciIgdGVzdD0iZmFsc2UiPgogICAgICAgIDxhZ2dyZWdhdG9yPjM3NTkxNzwvYWdncmVnYXRvcj4KICAgICAgICA8dG9rZW4%2BMDIzNDMyODctMWUxYS00YjkyLTgwMDgtMzY3ZTZjZTM1MjIxPC90b2tlbj4KICAgICAgICA8dmVyc2lvbj4wMDAyPC92ZXJzaW9uPgogICAgICAgIDxzdGFtcD4xMjM0NTY3ODk8L3N0YW1wPgogICAgICAgIDxyZWZlcmVuY2U%2BMTIzNDU2PC9yZWZlcmVuY2U%2BCiAgICAgICAgPGRldmljZT4xMDwvZGV2aWNlPgogICAgICAgIDxjb250ZW50PjE8L2NvbnRlbnQ%2BCiAgICAgICAgPHR5cGU%2BMDwvdHlwZT4KICAgICAgICA8YWxnb3JpdGhtPjM8L2FsZ29yaXRobT4KICAgICAgICA8Y3VycmVuY3k%2BRVVSPC9jdXJyZW5jeT4KICAgICAgICA8Y29tbWl0PmZhbHNlPC9jb21taXQ%2BCiAgICAgICAgPGRlc2NyaXB0aW9uPlNpUyB0b2tlbml6ZWQgcGF5bWVudCB0ZXN0IHJlcXVlc3Q8L2Rlc2NyaXB0aW9uPgogICAgICAgIDxpdGVtcz4KICAgICAgICAgICAgPGl0ZW0%2BCiAgICAgICAgICAgICAgICA8Y29kZS8%2BCiAgICAgICAgICAgICAgICA8ZGVzY3JpcHRpb24%2Bc3ViIHRyYWRlPC9kZXNjcmlwdGlvbj4KICAgICAgICAgICAgICAgIDxwcmljZSBjdXJyZW5jeT0iRVVSIiB2YXQ9IjIzIj4yNTAwPC9wcmljZT4KICAgICAgICAgICAgICAgIDxtZXJjaGFudD4zOTE4MzA8L21lcmNoYW50PgogICAgICAgICAgICAgICAgPGNvbnRyb2wvPgogICAgICAgICAgICA8L2l0ZW0%2BCiAgICAgICAgICAgIDxhbW91bnQgY3VycmVuY3k9IkVVUiI%2BMjUwMDwvYW1vdW50PgogICAgICAgIDwvaXRlbXM%2BCiAgICAgICAgPGJ1eWVyPgogICAgICAgICAgICA8Y291bnRyeT5GSU48L2NvdW50cnk%2BCiAgICAgICAgICAgIDxsYW5ndWFnZT5GSTwvbGFuZ3VhZ2U%2BCiAgICAgICAgPC9idXllcj4KICAgICAgICA8ZGVsaXZlcnk%2BCiAgICAgICAgICAgIDxkYXRlPjIwMTcwNjE5PC9kYXRlPgogICAgICAgIDwvZGVsaXZlcnk%2BCiAgICA8L3JlcXVlc3Q%2BCjwvY2hlY2tvdXQ%2BCg%3D%3D&amp;CHECKOUT_MAC=ECC3A796D38A2050C31CD841A593488F
</code></pre>
<blockquote>
<p>Respose XML</p>
</blockquote>
<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;response&gt;</span>
 <span class="nt">&lt;statusCode&gt;</span>201<span class="nt">&lt;/statusCode&gt;</span>
 <span class="nt">&lt;statusText&gt;</span>OK, authorization hold created<span class="nt">&lt;/statusText&gt;</span>
<span class="nt">&lt;/response&gt;</span>
</code></pre>
<h3 id="tokenized-sis-payment-using-minimum-required-fields">Tokenized SiS payment using minimum required fields</h3>

<p>Creates an authorization hold for 25.00 euros.</p>

<h1 id="payment-statuses">Payment Statuses</h1>

<table><thead>
<tr>
<th>Status</th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>-10</td>
<td>Payment refunded to the buyer</td>
</tr>
<tr>
<td>-4</td>
<td>Payment cannot be found</td>
</tr>
<tr>
<td>-3</td>
<td>Unpaid payment older that 14 days</td>
</tr>
<tr>
<td>-2</td>
<td>Payment cancelled by Checkout or payment method provider</td>
</tr>
<tr>
<td>-1</td>
<td>Payment cancelled by buyer</td>
</tr>
<tr>
<td>1 </td>
<td>Payment pending</td>
</tr>
<tr>
<td>2</td>
<td> Payment approved</td>
</tr>
<tr>
<td>3</td>
<td>Payment delayed, bank transfer payment method chosen by buyer</td>
</tr>
<tr>
<td>4</td>
<td>This status is saved for future additions. Works like status 3.</td>
</tr>
<tr>
<td>5</td>
<td>This status is saved for future additions. Approved payment.</td>
</tr>
<tr>
<td>6</td>
<td>Payment frozen</td>
</tr>
<tr>
<td>7</td>
<td> Payment method provider has accepted payment and it required approval by merchant</td>
</tr>
<tr>
<td> 8</td>
<td> Payment method provider has accepted payment and it has been approved</td>
</tr>
<tr>
<td>9</td>
<td>This status is saved for future additions.</td>
</tr>
<tr>
<td>10</td>
<td>Payment settled, approved payments (status = 2) change to status 10 when they have paid to merchant</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="code">code</a>
          </div>
      </div>
    </div>
  </body>
</html>
